# ═══════════════════════════════════════════════════════════════════════════
#  BERMUDAN SWAPTION PRICER — Configuration
#  Éditer ce fichier pour paramétrer le deal, ou alimenter via Excel/Python
# ═══════════════════════════════════════════════════════════════════════════

# ───────────────────────────────────────────────────────────────────────────
#  DEAL
# ───────────────────────────────────────────────────────────────────────────
deal:
  valuation_date: "2026-01-30"       # YYYY-MM-DD
  notional: 10000000                  # en CAD
  strike: 3.14817                     # en pourcentage (%)
  direction: "Receiver"               # Receiver ou Payer
  swap_start: "2027-02-12"
  swap_end: "2032-02-12"
  fixed_frequency: "SemiAnnual"       # SemiAnnual, Quarterly, Annual
  day_count: "ACT/365"                # ACT/365, ACT/360, 30/360
  payment_lag: 2                      # jours ouvrables
  currency: "CAD"

# ───────────────────────────────────────────────────────────────────────────
#  EXERCISE SCHEDULE
#  Si "auto": génère semi-annual à partir du swap schedule
#  Si liste de dates: utilise exactement ces dates
# ───────────────────────────────────────────────────────────────────────────
exercise:
  mode: "auto"                        # "auto" ou "custom"
  # custom_dates:                     # décommenter si mode=custom
  #   - "2027-02-12"
  #   - "2027-08-12"
  #   - "2028-02-14"
  #   - "2028-08-14"
  #   - "2029-02-12"
  #   - "2029-08-13"
  #   - "2030-02-12"
  #   - "2030-08-12"
  #   - "2031-02-12"
  #   - "2031-08-12"

# ───────────────────────────────────────────────────────────────────────────
#  MODEL
# ───────────────────────────────────────────────────────────────────────────
model:
  name: "HW1F"                        # Hull-White 1 facteur
  mean_reversion: 0.03                # a (BBG default = 0.03)
  calibrate_a: false                  # true = calibrer a conjointement
  fdm_time_grid: 300
  fdm_space_grid: 300

# ───────────────────────────────────────────────────────────────────────────
#  GREEKS
# ───────────────────────────────────────────────────────────────────────────
greeks:
  dv01_bump_bp: 1.0
  gamma_bump_bp: 1.0
  vega_bump_bp: 1.0
  compute_theta: true
  theta_method: "1bd_roll"            # "1bd_roll" ou "1cd_roll"
  theta_annualization: "365/252"      # "365/252" ou "none"

# ───────────────────────────────────────────────────────────────────────────
#  DATA SOURCE
#  mode: "bloomberg" (via blpapi) ou "manual" (fichiers CSV/YAML)
# ───────────────────────────────────────────────────────────────────────────
data_source:
  mode: "manual"                      # "bloomberg" ou "manual"

  # --- Bloomberg API settings (si mode=bloomberg) ---
  bloomberg:
    curve_ticker: "YCSW0147 Index"    # CAD OIS curve (ICVS 147)
    vol_source: "VCUB"                # VCUB ou BVOL
    vol_ticker: "CAD"                 # pour BVOL: "CAD"
    swaption_ticker: ""               # ticker SWPM si dispo (optionnel)
    timeout_ms: 30000

  # --- Manual data files (si mode=manual) ---
  manual:
    curve_file: "curve.csv"           # CSV: date,discount_factor
    vol_file: "vol_surface.csv"       # CSV: matrice complète
    # Si pas de fichier, les données sont lues dans ce YAML ci-dessous

# ───────────────────────────────────────────────────────────────────────────
#  BBG BENCHMARK (pour comparaison — optionnel)
#  Remplir avec les valeurs SWPM pour validation
# ───────────────────────────────────────────────────────────────────────────
benchmark:
  npv: 202935.23                      # OBLIGATOIRE: cible pour inverse-solve
  atm_strike: 3.006868                # %  (optionnel, pour comparaison)
  yield_value_bp: 44.879              # bp (optionnel)
  underlying_premium: 0.63894         # %  (optionnel)
  premium: 2.02935                    # %  (optionnel)
  dv01: 2464.17                       # (optionnel)
  gamma_1bp: 21.58                    # (optionnel)
  vega_1bp: 2670.37                   # (optionnel)
  theta_1d: -125.53                   # (optionnel)
  delta_hedge: null                   # null si pas dispo
  underlying_dv01: null               # null si pas dispo

# ───────────────────────────────────────────────────────────────────────────
#  INLINE DATA (utilisé si data_source.mode=manual ET pas de fichier CSV)
# ───────────────────────────────────────────────────────────────────────────
curve_data:
  # date, discount_factor
  - ["2026-02-09", 0.999382]
  - ["2026-02-17", 0.998888]
  - ["2026-03-02", 0.998085]
  - ["2026-04-02", 0.996178]
  - ["2026-05-04", 0.994221]
  - ["2026-06-02", 0.992460]
  - ["2026-07-02", 0.990646]
  - ["2026-08-04", 0.988655]
  - ["2026-11-02", 0.983222]
  - ["2027-02-02", 0.977527]
  - ["2027-08-03", 0.965602]
  - ["2028-02-02", 0.952657]
  - ["2029-02-02", 0.925684]
  - ["2030-02-04", 0.898205]
  - ["2031-02-03", 0.870350]
  - ["2032-02-02", 0.841828]
  - ["2033-02-02", 0.812802]
  - ["2034-02-02", 0.783629]
  - ["2035-02-02", 0.754514]
  - ["2036-02-04", 0.725661]
  - ["2038-02-02", 0.669294]
  - ["2041-02-04", 0.590495]
  - ["2046-02-02", 0.479844]
  - ["2051-02-02", 0.399290]
  - ["2056-02-02", 0.337536]

vol_surface_data:
  # BPx10 scale — rows=expiry, cols=tenor
  expiry_labels: ["1Mo","3Mo","6Mo","9Mo","1Yr","2Yr","3Yr","4Yr","5Yr","6Yr","7Yr","8Yr","9Yr","10Yr","12Yr","15Yr","20Yr","25Yr"]
  tenor_labels:  ["1Y","2Y","3Y","4Y","5Y","6Y","7Y","8Y","9Y","10Y","12Y","15Y","20Y","25Y","30Y"]
  values:
    - [2.05, 2.64, 3.04, 3.07, 3.51, 3.55, 3.56, 3.56, 3.55, 3.55, 3.54, 3.56, 3.55, 3.55, 3.53]
    - [2.60, 3.29, 3.46, 3.55, 3.73, 3.78, 3.77, 3.78, 3.78, 3.76, 3.70, 3.66, 3.60, 3.63, 3.60]
    - [3.06, 3.65, 3.73, 3.80, 3.92, 3.90, 3.88, 3.89, 3.87, 3.86, 3.80, 3.77, 3.74, 3.69, 3.66]
    - [3.43, 3.84, 3.92, 3.92, 4.03, 4.03, 4.01, 4.00, 3.99, 3.98, 3.92, 3.87, 3.84, 3.79, 3.74]
    - [3.73, 4.03, 4.08, 4.09, 4.17, 4.16, 4.12, 4.12, 4.10, 4.09, 4.01, 3.97, 3.92, 3.86, 3.81]
    - [4.21, 4.22, 4.25, 4.28, 4.35, 4.32, 4.30, 4.28, 4.25, 4.23, 4.13, 4.08, 3.99, 3.95, 3.87]
    - [4.33, 4.34, 4.36, 4.38, 4.40, 4.38, 4.35, 4.33, 4.30, 4.28, 4.18, 4.12, 4.07, 4.00, 3.91]
    - [4.33, 4.35, 4.38, 4.39, 4.39, 4.37, 4.40, 4.37, 4.36, 4.34, 4.18, 4.17, 4.07, 3.97, 3.88]
    - [4.36, 4.38, 4.41, 4.41, 4.41, 4.43, 4.37, 4.34, 4.32, 4.30, 4.15, 4.13, 4.05, 3.94, 3.85]
    - [4.35, 4.35, 4.37, 4.36, 4.42, 4.36, 4.32, 4.25, 4.28, 4.26, 4.15, 4.11, 4.02, 3.89, 3.81]
    - [4.34, 4.33, 4.34, 4.34, 4.40, 4.30, 4.28, 4.25, 4.23, 4.21, 4.10, 4.05, 3.97, 3.84, 3.77]
    - [4.29, 4.30, 4.33, 4.29, 4.33, 4.25, 4.22, 4.19, 4.17, 4.15, 4.04, 4.00, 3.92, 3.80, 3.72]
    - [4.25, 4.25, 4.29, 4.24, 4.29, 4.20, 4.17, 4.14, 4.13, 4.10, 3.98, 3.93, 3.86, 3.74, 3.66]
    - [4.16, 4.22, 4.24, 4.25, 4.24, 4.20, 4.17, 4.03, 3.97, 3.96, 3.85, 3.79, 3.74, 3.66, 3.59]
    - [4.04, 4.12, 4.10, 4.12, 4.13, 4.09, 4.05, 3.86, 3.75, 3.74, 3.63, 3.60, 3.52, 3.48, 3.42]
    - [3.90, 3.98, 3.96, 3.98, 3.94, 3.88, 3.86, 3.75, 3.78, 3.60, 3.49, 3.46, 3.42, 3.35, 3.30]
    - [3.71, 3.79, 3.75, 3.73, 3.75, 3.65, 3.68, 3.65, 3.61, 3.60, 3.49, 3.46, 3.42, 3.35, 3.30]
    - [3.57, 3.61, 3.62, 3.61, 3.57, 3.56, 3.53, 3.51, 3.49, 3.47, 3.36, 3.36, 3.31, 3.27, 3.25]

# ───────────────────────────────────────────────────────────────────────────
#  OUTPUT
# ───────────────────────────────────────────────────────────────────────────
output:
  print_console: true
  export_excel: true
  excel_file: "bermudan_results.xlsx"
  export_csv: false
